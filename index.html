<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Heart Particles</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

let particles = [];
let t = 0;

// ---- HÀM TRÁI TIM 3D MỀM MƯỢT + PHỒNG ----
function heartPoint(angle, scale) {
    // Công thức trái tim 3D mềm
    let x = 15 * Math.sin(angle) ** 3;
    let y = -(
        12 * Math.cos(angle) -
        5 * Math.cos(2 * angle) -
        2 * Math.cos(3 * angle) -
        Math.cos(4 * angle)
    );

    // Hiệu ứng phồng 3D (nhịp đập + độ sâu)
    let puff = 1 + 0.15 * Math.sin(angle * 2 + t * 2);

    return {
        x: canvas.width / 2 + x * scale * puff,
        y: canvas.height / 2 + y * scale * puff
    };
}

// ---- TẠO HẠT TRÊN BỀ MẶT + VIỀN TRÁI TIM ----
function spawnParticle() {
    let scale = 10 + Math.sin(t) * 1.4; // nhịp đập mạnh hơn tí
    let angle = Math.random() * Math.PI * 2;

    // 80% hạt ở viền - 20% bên trong
    let r = (Math.random() < 0.8) ? 1 : (0.6 + Math.random() * 0.35);

    let hp = heartPoint(angle, scale * r);

    let speed = 0.6 + Math.random() * 1.2;

    particles.push({
        x: hp.x,
        y: hp.y,
        vx: (Math.random() - 0.5) * speed,
        vy: (Math.random() - 0.5) * speed,
        alpha: 1,
        size: Math.random() * 2 + 1,
        color: "#ff4fa3"
    });
}

// ---- VẼ ANIMATION ----
function animate() {
    requestAnimationFrame(animate);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    t += 0.07;

    // tạo rất nhiều hạt -> trái tim dày và sáng
    for (let i = 0; i < 160; i++) spawnParticle();

    // vẽ từng hạt
    for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i];
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, p.size, p.size);

        p.x += p.vx;
        p.y += p.vy;

        p.alpha -= 0.012; // hạt mờ chậm -> giữ độ dày

        if (p.alpha <= 0) particles.splice(i, 1);
    }
}

animate();
</script>
</body>
</html>
